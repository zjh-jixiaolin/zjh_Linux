# Linux 端口与进程管理

[TOC]

文档：[link](http://c.biancheng.net/view/705.html)

## 0. 端口

端口，是设备与外界通讯的出入口。端口可分为两种：**物理端口**和**虚拟端口**。

- 物理端口：又称为接口，是可见的端口，如电脑 `USB`接口、`RJ45`网口、`HDMI`端口等。

  ![image-20230517010110847](https://raw.githubusercontent.com/zjh-jixiaolin/map_strong/main/202305170124115.png)

- 虚拟端口：指计算机内部的端口，是不可见的，是操作系统用来与外部进行交互使用的。

  ![image-20230517010419579](https://raw.githubusercontent.com/zjh-jixiaolin/map_strong/main/202305170124716.png)

### 虚拟端口

**物理端口**比较好理解，而 **虚拟端口** 的定义很模糊，如虚拟端口有什么作用，为什么需要它？如下举例：

- 当两台计算机进行通讯，计算机`A` —> 计算机`B`。通过 `IP`地址即可找到对应主机

  ![image-20230517012543065](https://raw.githubusercontent.com/zjh-jixiaolin/map_strong/main/202305170125787.png)

- 两台计算机上都运行着各种的程序，当计算机 `A` 的微信程序 —>计算机`B` 的微信程序进行通讯，如果只通过`IP` 地址会显得不够精确，因为`IP`地址代表一台计算机在网络中的位置，它锁定不了计算机中某个具体程序。这种问题可以通过 **虚拟端口** 去解决，如下图，计算机 `A` 通过端口`50001`去发出访问请求到计算机 `B` 的端口`5678`，由此可发现，通过访问端口就等同于访问计算机上的微信程序。

  ![image-20230517011146889](https://raw.githubusercontent.com/zjh-jixiaolin/map_strong/main/202305170124823.png)

>**总结**：
>
>计算机程序之间的通讯，`IP`地址只能锁定计算机位置，无法锁定具体的应用程序。
>
>通过 **端口** 可以锁定计算机具体的应用程序，确保程序之间的通讯。
>
>IP地址相当于小区地址，在小区内有许多住户（**程序**），而门牌号（**端口**）就是各个住户（**程序**）的联系地址。



<br />



### Linux 端口

`Linux` 系统是一个超大号小区，支持 `65535` 个端口，这 `65535`个端口分为`3`类：

- **公认端口**： `1 ~ 1023`，用于系统内置或知名程序的预留使用，如 `SSH` 服务的 `22` 端口，`HTTPS`服务的 `443` 端口，`WWW`服务的 `80` 端口。

- **注册端口**：`1024 ~ 49151`，可随意使用，用于松散的绑定一些程序/服务（如编写了一个程序，当运行程序需要网络通讯时，可绑定此范围端口）。

- **动态端口：** `49152 ~ 65535`，不会固定绑定程序，而是当程序对外进行网络链接时，用于临时使用。

如上图计算机`A`的微信连接到计算机`B`的微信，`A`发送一条消息，此时使用的`50001`即**动态端口**，是系统临时找一个端口作为出口发出消息，发出后就会释放此端口，下次发送消息时可能使用的就是`60001`动态端口发出。而`B`的微信使用端口`5678`，即**注册端口**，长期绑定此端口等待别人连接。

### 查看端口占用

#### nmap 命令

通过 `nmap` 命令查看网络主机端口的占用情况：

- 安装 `yum -y install nmap`

功能：扫描网络主机的开放端口。

语法：`nmap IP地址`

实例：

```bash
# 查看本机开放端口
nmap 127.0.0.1
> Starting Nmap 6.40 ( http://nmap.org ) at 2023-05-17 02:05 CST
> Nmap scan report for localhost (127.0.0.1)
> Host is up (0.0000070s latency).
> Not shown: 998 closed ports
> PORT   STATE SERVICE
> 22/tcp open  ssh
> 25/tcp open  smtp
> # 可以看到，本机上有2个端口被程序占用，其中22端口为SSH远程服务。

```

#### netstat 命令

安装：`yum -y install net-tools`

功能：查看端口占用或空闲状态。

用法：`netstat -anp | grep xxx`

```bash
# 查看端口是否被占用
netstat -anp | grep 5000
```



<br />

<br />



## 1. 进程

程序运行在操作系统上，是被操作系统所管理的。

为管理运行的程序，每个程序在运行时，便被操作系统注册为系统中的一个：**进程**

并会为每个进程分配一个独有的：进程`ID`（进程号）

![image-20230517103157129](https://raw.githubusercontent.com/zjh-jixiaolin/map_strong/main/202305171032548.png)

### 查看进程

#### ps 命令

功能：查看 `Linux` 系统中进程信息。

语法：`ps [-e -f]`

- 选项：`-e` 列出全部的进程。
- 选项：`-f` 以完全格式化形式展示信息（展示全部信息）。

固定用法：`ps -ef` 列出全部进程的全部信息，`ps -ef | grep tail` 查看指定进程信息。具体内容如下：

![image-20230517104209054](https://raw.githubusercontent.com/zjh-jixiaolin/map_strong/main/202305171042019.png)

从左到右分别为：

- `UID`：进程所属的用户 `ID`。
- `PID`：进程的进程号 `ID`。
- `PPID`：进程的父 `ID`（启动此进程的其他进程）。
- `C`：此进程的`CPU` 占用率（百分比）。
- `STIME`：进程的启动时间。
- `TTY`：启动此进程的终端序号，如显示 `?`，表示非终端启动，而是系统内置启动的。
- `TIME`：进程占用 `CPU` 的时间。
- `CMD`：进程对应的名称 或 启动路径 或 启动命令。
- 

### 查看指定进程

使用 **管道符** 配合`grep`来进行过滤，以此来查看指定进程，如 `ps -ef | grep tail` 即可准确找到 `tail`命令的信息。

```bash
ps -ef | grep tail
> zjh       9269  8882  0 10:58 pts/0    00:00:00 tail # 输入tail，在另外一个终端查看进程的结果如左显示。
> zjh       9336  9324  0 10:59 pts/1    00:00:00 grep --color=auto tail # 上方命令也是一个程序，也是一个进程。
```

- 过滤不仅仅能过滤名称，还能过滤进程号、用户`ID` 等等。
- 如：`ps -ef | grep 30001` 过滤带有 `30001` 关键字的进程信息（一般指过滤`30001`进程号）



### 关闭/杀死 进程

在 `Windows` 系统中，通过任务管理器选择进程后，点击 **结束进程** 即可 **关闭/杀死** 它。

同样，在 `Linux` 系统中，可通过 `kill` 命令 **关闭/杀死** 进程。

语法： `kill [-9] 进程ID`

- 选项：`-9` 表示强制关闭进程。

- 默认 `kill 进程ID` 会向进程发送信号要求关闭，但是是否关闭需看进程自身处理机制。实例如下：

  ```bash
  # 询问关闭进程（tail 进程号）
  zjh@ubantu:~$ tail
  Terminated # 终止
  
  # 强制杀死进程（tail -9 进程号）
  zjh@ubantu:~$ tail
  > Killed # 杀死
  ```

  







